From linux-rt-users-owner@vger.kernel.org Fri Jul 13 20:13:10 2007
Return-Path: <linux-rt-users-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.1.7-deb (2006-10-05) on debian
X-Spam-Level: 
X-Spam-Status: No, score=0.0 required=5.0 tests=AWL autolearn=unavailable 
	version=3.1.7-deb
Received: from vger.kernel.org (vger.kernel.org [209.132.176.167]) by
	mail.tglx.de (Postfix) with ESMTP id 9AD1E65C3E9; Fri, 13 Jul 2007 20:13:10
	+0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand id
	S1760492AbXGMSNJ (ORCPT <rfc822;jan.altenberg@linutronix.de> + 1 other);
	Fri, 13 Jul 2007 14:13:09 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932549AbXGMSNJ
	(ORCPT <rfc822;linux-rt-users-outgoing>); Fri, 13 Jul 2007 14:13:09 -0400
Received: from deeprooted.net ([216.254.16.51]:38939 "EHLO
	paris.hilman.org" rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
	id S1759850AbXGMSNG (ORCPT <rfc822;linux-rt-users@vger.kernel.org>); Fri,
	13 Jul 2007 14:13:06 -0400
Received: by paris.hilman.org (Postfix, from userid 1000) id 98015E4C5C2;
	Fri, 13 Jul 2007 10:52:28 -0700 (PDT)
Message-Id: <20070713175228.311226264@mvista.com>
References: <20070713175214.336577416@mvista.com>
User-Agent: quilt/0.45-1
Date:	Fri, 13 Jul 2007 10:52:17 -0700
From:	Kevin Hilman <khilman@mvista.com>
To:	tglx@linutronix.de, mingo@elte.hu
Cc:	linux-rt-users@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: [PATCH -rt 3/6] Compile fix for PREEMPT_TIMING on and
	TRACE_IRQFLAGS off
Content-Disposition: inline; filename=latency-trace-fix.patch
Sender:	linux-rt-users-owner@vger.kernel.org
Precedence: bulk
X-Mailing-List:	linux-rt-users@vger.kernel.org
X-Filter-To: .Kernel.rt-users
X-Evolution-Source: imap://tglx%40linutronix.de@localhost:8993/
Content-Transfer-Encoding: 8bit
Mime-Version: 1.0

Fix compile of latency_trace.c in the case where
CRITICAL_PREEMPT_TIMING=y and TRACE_IRQFLAGS=n (because DEBUG_KERNEL
is disabled)

Signed-off-by: Kevin Hilman <khilman@mvista.com>
---
 kernel/latency_trace.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: linux-2.6.23.1-rt5/kernel/latency_trace.c
===================================================================
--- linux-2.6.23.1-rt5.orig/kernel/latency_trace.c
+++ linux-2.6.23.1-rt5/kernel/latency_trace.c
@@ -2154,7 +2154,7 @@ void notrace unmask_preempt_count(unsign
 }
 EXPORT_SYMBOL(unmask_preempt_count);
 
-#ifdef CONFIG_CRITICAL_PREEMPT_TIMING
+#if defined(CONFIG_CRITICAL_PREEMPT_TIMING) && defined(CONFIG_TRACE_IRQFLAGS)
 
 /* Some archs do their cpu_idle with preemption on. Don't measure it */
 void notrace trace_preempt_enter_idle(void)
