---
 kernel/workqueue.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: linux-2.6.23.1-rt5/kernel/workqueue.c
===================================================================
--- linux-2.6.23.1-rt5.orig/kernel/workqueue.c
+++ linux-2.6.23.1-rt5/kernel/workqueue.c
@@ -620,7 +620,7 @@ int schedule_on_each_cpu(void (*func)(vo
 		}
 	}
 
-	preempt_disable();		/* CPU hotplug */
+	lock_cpu_hotplug();
 	for_each_online_cpu(cpu) {
 		struct schedule_on_each_cpu_work *work;
 
@@ -633,7 +633,7 @@ int schedule_on_each_cpu(void (*func)(vo
 		set_bit(WORK_STRUCT_PENDING, work_data_bits(&work->work));
 		__queue_work(per_cpu_ptr(keventd_wq->cpu_wq, cpu), &work->work);
 	}
-	preempt_enable();
+	unlock_cpu_hotplug();
 
 out:
 	for_each_possible_cpu(cpu) {
